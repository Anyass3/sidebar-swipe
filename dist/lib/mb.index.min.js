import{writable}from"svelte/store";const Writable=t=>{const{subscribe:i,...e}=writable(t);return{subscribe:i,...e,get:()=>{let t;return i((i=>{t=i}))(),t}}};class SideBarSwipe{constructor(t,{sideOpacity:i=.2,transitionDuration:e=300,maxScreenWidth:s=768,transitionTimingFunc:h="cubic-bezier(0.9, 0.28, 0.08, 1.13)"}={}){const n=Array.from(document.querySelectorAll("sidebar-swipe")).filter((i=>i.shadowRoot&&i.shadowRoot.querySelector(t)));this.swipe=n.length>0?n[0].shadowRoot.firstElementChild:document.querySelector(t),this.swipe.style.display="none",this.duration=e,this.timingFn=h,this.screenWidth=s,this.endTranslate=0,this.beforeEndTranslate=0,this.opened=Writable(!0),this.prevcx=0,this.opacity=i,this.initStart(),this.initEvents()}get right(){return this.swipe.hasAttribute("right")&&!("false"===this.swipe.getAttribute("right")||!1===this.swipe.getAttribute("right"))}set right(t){this.swipe.setAttribute("right",t),this.initStart()}get width(){const t=this.swipe.firstElementChild.getAttribute("width");return t?/^[0-9]+$/.test(`${t}`)?t+"%":t:"80%"}get applied(){return window.innerWidth<=this.screenWidth}_navtransition_(t=!0){this.swipe.firstElementChild.style.transition=t?`transform ${this.duration}ms ${this.timingFn}`:""}initStart(){this.applied?(this.swipe.style.width="100%",this.swipe.style.position="fixed",this.swipe.style.overflowY="overlay",this.swipe.style.height="100%",this.swipe.firstElementChild.style.minHeight="100%",this.swipe.style.transition="background .5s ease",this.swipe.style.background="rgba(0,0,0,0)",this.swipe.style.display="none",this.swipe.firstElementChild.style.width=this.width,this.swipe.addEventListener("click",(t=>{t.target===t.currentTarget&&this.close()})),this._navtransition_(),this.endTranslate=(this.right?1:-1)*document.body.offsetWidth,this.opened.set(!1),this.setTransform(),this.wasApplied||this.swipe.addEventListener("click",(t=>{t.target===t.currentTarget&&this.close()})),this.wasApplied=!0):(this.swipe.style.position="",this.swipe.style.overflowY="",this.swipe.style.height="",this.swipe.firstElementChild.style.minHeight="",this.swipe.style.transition="",this.swipe.style.width="",this.swipe.style.background="",this.swipe.style.display="",this.swipe.style.justifyContent="",this.swipe.firstElementChild.style.width="",this._navtransition_(!1),this.swipe.firstElementChild.style.transform="",this.initEvents(!0),this.wasApplied||this.swipe.removeEventListener("click",(t=>{t.target===t.currentTarget&&this.close()})),this.wasApplied=!1)}initEvents(t=!1){this.swipe[t?"removeEventListener":"addEventListener"]("touchstart",(t=>this.startFn(t)),!1),this.swipe[t?"removeEventListener":"addEventListener"]("touchmove",(t=>this.moveFn(t)),!1),this.swipe[t?"removeEventListener":"addEventListener"]("touchend",(t=>this.endFn(t)),!1),this.swipe[t?"removeEventListener":"addEventListener"]("touchcancel",(t=>console.log(t)),!1)}startFn(t){this.applied&&(this.prevcx=t.touches[0].clientX,this.touchType="start")}moveFn(t){if(t.preventDefault(),this.applied){this._navtransition_(!1);let i=t.touches[0].clientX,e=this.endTranslate+i-this.prevcx;i>2&&(e<0&&!this.right||e>0&&this.right)&&(this.endTranslate=e,this.beforeEndTranslate=Math.abs(e),this.setTransform(),this.prevcx=i,this.touchType="move")}}endFn(t){this.applied&&"move"===this.touchType&&(this._navtransition_(),this.beforeEndTranslate/this.swipe.offsetWidth*100>40?this.close():this.open(),this.touchType="end")}setTransform(){if(this.applied){this.swipe.firstElementChild.style.transform=`translate(${this.endTranslate+"px"})`;const t=this.opacity-this.beforeEndTranslate/this.swipe.firstElementChild.offsetWidth*this.opacity;this.swipe.style.background=`rgba(0,0,0,${t})`}}open(){this.applied&&(this.swipe.style.display="block",this.swipe.firstElementChild.style.float=this.right?"right":"left",this.swipe.firstElementChild.classList.add("sb-opened"),setTimeout((()=>{this.endTranslate=0,this.opened.set(!0),this.setTransform(),this.swipe.style.background=`rgba(0,0,0,${this.opacity})`}),.8))}close(){if(this.applied){const t=(this.right?1:-1)*this.swipe.offsetWidth;this.endTranslate=t,this.opened.set(!1),this.setTransform(),this.swipe.style.background="rgba(0,0,0,0)",setTimeout((()=>{this.swipe.style.display="none",this.swipe.firstElementChild.classList.remove("sb-opened")}),this.duration)}}toggle(){this.opened.get()?this.close():this.open()}}
